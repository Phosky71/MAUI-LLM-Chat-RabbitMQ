<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MAUILLMChatRabbitMQ.ViewModels"
             x:Class="MAUILLMChatRabbitMQ.Views.ConfigPage"
             Title="丘뙖잺 Configuraci칩n"
             BackgroundColor="#F5F5F7">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!-- ===== SECCI칍N LLM (P칰rpura) ===== -->
            <Frame BackgroundColor="White"
                   BorderColor="#512BD4"
                   CornerRadius="15"
                   Padding="20"
                   HasShadow="True">

                <VerticalStackLayout Spacing="15">

                    <!-- Header -->
                    <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                        <Label Text="游뱄" FontSize="24"/>
                        <Label Text="Inteligencia Artificial" 
                               FontSize="20" 
                               FontAttributes="Bold"
                               TextColor="#512BD4"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>

                    <BoxView HeightRequest="1" Color="#512BD4" Opacity="0.2"/>

                    <!-- Configuraci칩n B치sica -->
                    <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,*" RowSpacing="15" ColumnSpacing="15">
                        <!-- Nombre App -->
                        <VerticalStackLayout Grid.Row="0" Grid.Column="0" Spacing="5">
                            <Label Text="Nombre App" FontSize="12" TextColor="Gray"/>
                            <Entry Text="{Binding AppName}" Placeholder="Ej: Agente A" FontAttributes="Bold"/>
                        </VerticalStackLayout>

                        <!-- Modelo -->
                        <VerticalStackLayout Grid.Row="0" Grid.Column="1" Spacing="5">
                            <Label Text="Modelo" FontSize="12" TextColor="Gray"/>
                            <Entry Text="{Binding ModelName}" Placeholder="llama-3.2..."/>
                        </VerticalStackLayout>

                        <!-- URL (Ocupa dos columnas) -->
                        <VerticalStackLayout Grid.Row="1" Grid.ColumnSpan="2" Spacing="5">
                            <Label Text="Endpoint API (URL)" FontSize="12" TextColor="Gray"/>
                            <Entry Text="{Binding BaseURL}" Keyboard="Url" Placeholder="http://localhost:1234/v1" TextColor="#333"/>
                        </VerticalStackLayout>
                    </Grid>

                    <!-- System Prompt -->
                    <VerticalStackLayout Spacing="8">
                        <Label Text="System Prompt (Personalidad)" FontSize="14" FontAttributes="Bold" TextColor="#333"/>
                        <Frame Padding="10" CornerRadius="8" BorderColor="#E0E0E0" BackgroundColor="#FAFAFA" HasShadow="False">
                            <Editor Text="{Binding SystemPrompt}" 
                                    HeightRequest="100"
                                    AutoSize="TextChanges"
                                    Placeholder="Define aqu칤 c칩mo debe comportarse la IA..."/>
                        </Frame>
                    </VerticalStackLayout>

                    <!-- Sliders con Valor Visible -->
                    <VerticalStackLayout Spacing="10">
                        <!-- Temperatura -->
                        <Grid ColumnDefinitions="*, Auto">
                            <Label Text="Creatividad (Temperatura)" VerticalOptions="Center" TextColor="#333"/>
                            <Label Grid.Column="1" Text="{Binding Temperature, StringFormat='{0:F1}'}" FontAttributes="Bold" TextColor="#512BD4"/>
                        </Grid>
                        <Slider Minimum="0" Maximum="2" Value="{Binding Temperature}" MinimumTrackColor="#512BD4" ThumbColor="#512BD4"/>

                        <!-- Tokens -->
                        <Grid ColumnDefinitions="*, Auto">
                            <Label Text="Longitud M치xima (Tokens)" VerticalOptions="Center" TextColor="#333"/>
                            <Label Grid.Column="1" Text="{Binding MaxTokens}" FontAttributes="Bold" TextColor="#512BD4"/>
                        </Grid>
                        <Slider Minimum="50" Maximum="4096" Value="{Binding MaxTokens}" MinimumTrackColor="#512BD4" ThumbColor="#512BD4"/>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- ===== SECCI칍N RABBITMQ (Coral/Rojo) ===== -->
            <Frame BackgroundColor="White"
                   BorderColor="#FF6B6B"
                   CornerRadius="15"
                   Padding="20"
                   HasShadow="True">

                <VerticalStackLayout Spacing="15">

                    <!-- Header -->
                    <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                        <Label Text="游니" FontSize="24"/>
                        <Label Text="Conexi칩n RabbitMQ" 
                               FontSize="20" 
                               FontAttributes="Bold"
                               TextColor="#FF6B6B"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>

                    <BoxView HeightRequest="1" Color="#FF6B6B" Opacity="0.2"/>

                    <!-- Conexi칩n Servidor -->
                    <Grid ColumnDefinitions="2*,*" ColumnSpacing="15">
                        <VerticalStackLayout Grid.Column="0" Spacing="5">
                            <Label Text="Servidor (Host)" FontSize="12" TextColor="Gray"/>
                            <Entry Text="{Binding RabbitHostName}" Placeholder="localhost"/>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1" Spacing="5">
                            <Label Text="Puerto" FontSize="12" TextColor="Gray"/>
                            <Entry Text="{Binding RabbitPort}" Keyboard="Numeric" HorizontalTextAlignment="Center"/>
                        </VerticalStackLayout>
                    </Grid>

                    <!-- Credenciales -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                        <VerticalStackLayout Grid.Column="0" Spacing="5">
                            <Label Text="Usuario" FontSize="12" TextColor="Gray"/>
                            <Entry Text="{Binding RabbitUserName}"/>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1" Spacing="5">
                            <Label Text="Contrase침a" FontSize="12" TextColor="Gray"/>
                            <Entry Text="{Binding RabbitPassword}" IsPassword="True"/>
                        </VerticalStackLayout>
                    </Grid>

                    <!-- Exchange -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Nombre del Exchange" FontSize="12" TextColor="Gray"/>
                        <Entry Text="{Binding ExchangeName}" Placeholder="llm_chat_exchange"/>
                    </VerticalStackLayout>

                    <!-- Colas (CR칈TICO PARA LA COMUNICACI칍N) -->
                    <Label Text="Enrutamiento de Mensajes" FontSize="14" FontAttributes="Bold" Margin="0,5,0,0"/>

                    <Frame BackgroundColor="#FFF5F5" BorderColor="#FF6B6B" CornerRadius="10" Padding="15" HasShadow="False">
                        <VerticalStackLayout Spacing="15">
                            <!-- Publicaci칩n -->
                            <Grid ColumnDefinitions="30, *" ColumnSpacing="10">
                                <Label Text="游닋" VerticalOptions="Center" FontSize="18"/>
                                <VerticalStackLayout Grid.Column="1" Spacing="2">
                                    <Label Text="Publicar hacia (Destino)" FontSize="11" TextColor="#FF6B6B" FontAttributes="Bold"/>
                                    <Entry Text="{Binding PublishQueueName}" Placeholder="app1_out" BackgroundColor="White"/>
                                    <Label Text="* La otra App debe ESCUCHAR aqu칤" FontSize="10" TextColor="Gray" FontAttributes="Italic"/>
                                </VerticalStackLayout>
                            </Grid>

                            <!-- Separador punteado visual -->
                            <BoxView HeightRequest="1" Color="#FF6B6B" Opacity="0.2"/>

                            <!-- Suscripci칩n -->
                            <Grid ColumnDefinitions="30, *" ColumnSpacing="10">
                                <Label Text="游닌" VerticalOptions="Center" FontSize="18"/>
                                <VerticalStackLayout Grid.Column="1" Spacing="2">
                                    <Label Text="Escuchar desde (Origen)" FontSize="11" TextColor="#28a745" FontAttributes="Bold"/>
                                    <Entry Text="{Binding SubscribeQueueName}" Placeholder="app2_out" BackgroundColor="White"/>
                                    <Label Text="* La otra App debe PUBLICAR aqu칤" FontSize="10" TextColor="Gray" FontAttributes="Italic"/>
                                </VerticalStackLayout>
                            </Grid>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- ID T칠cnico -->
                    <VerticalStackLayout Spacing="2" Opacity="0.6">
                        <Label Text="Identificador 칔nico de Instancia (App ID)" FontSize="10" HorizontalTextAlignment="Center"/>
                        <Label Text="{Binding AppId}" FontSize="10" TextColor="Gray" HorizontalTextAlignment="Center"/>
                    </VerticalStackLayout>

                </VerticalStackLayout>
            </Frame>

            <!-- ===== BOT칍N GUARDAR (CORREGIDO) ===== -->
            <Button Text="Guardar Cambios" 
                    Command="{Binding SaveConfigCommand}"
                    BackgroundColor="#512BD4"
                    TextColor="White"
                    FontSize="16"
                    FontAttributes="Bold"
                    HeightRequest="50"
                    CornerRadius="25"
                    Margin="0,10,0,30">
                <!-- Sombra definida expl칤citamente -->
                <Button.Shadow>
                    <Shadow Brush="#512BD4" Offset="0,5" Radius="10" Opacity="0.3"/>
                </Button.Shadow>
            </Button>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
